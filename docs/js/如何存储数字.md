**IEEE-754 标准**

JavaScript 的数字是 IEEE-754 标准存储的双精度浮点数类型。双精度浮点数总共有 64 位（bit），第一位用于表示符号，接着十一位用于表示阶码，剩余的五十二位用于表示尾数。

![ieee754-1.png](/img/doc/js/ieee754-1.png)

符号位很好理解，0 表示正数，1 表示负数。阶码和尾数表示什么呢？IEEE-754 标准中，一个浮点数将被使用二进制科学计数法的方式存储。看下面的公式：

![ieee754-2.png](/img/doc/js/ieee754-2.png)

**0.1 + 0.2 !== 0.3**

小数在计算机的存储过程中本身就存在精度丢失的问题，然后尾数的位数总共只有 52 位，放不下时会被丢弃，并按照 `舍 0 补 1` 来弥补导致最终运算结果不相等。

**怎么解决**

1. 将数字转成整数

```js
function add(num1, num2) {
  const num1Digits = (num1.toString().split('.')[1] || '').length
  const num2Digits = (num2.toString().split('.')[1] || '').length
  const baseNum = Math.pow(10, Math.max(num1Digits, num2Digits))
  return (num1 * baseNum + num2 * baseNum) / baseNum
}
```

2. 使用 `Number.EPSILON` 误差范围。

```js
function isEqual(a, b) {
  return Math.abs(a - b) < Number.EPSILON
}

console.log(isEqual(0.1 + 0.2, 0.3)) // true
```

Number.EPSILON 的实质是一个可以接受的最小误差范围，一般来说为 Math.pow(2, -52) 。

3. 三方库

- [mathjs](https://mathjs.org/)
- [bigjs](http://mikemcl.github.io/big.js/)

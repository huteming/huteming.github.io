---
title: React 生命周期
tags: [react]
---

这里来记录下 React 的几个阶段的生命周期钩子。不过，看官方的[文档](https://zh-hans.reactjs.org/docs/react-component.html#the-component-lifecycle)可能来的更加直接。

<!--truncate-->

## 挂载

### constructor

```js
constructor(props)
```

可以做组件的初始化工作，比如说可以初始化 state，在 constructor 中可以直接修改 state，使用 this.state 进行赋值，**不能使用 this.setState 方法**

### componentWillMount

```js
componentWillMount()
```

:::caution 注意
在 v16.3 版本之后被列为即将过时，同时引入新的别名: **UNSAFE_componentWillMount()**。官方的版本计划[在这里](https://zh-hans.reactjs.org/blog/2018/03/27/update-on-async-rendering.html)
:::

在挂载之前被调用。它在 render() 之前调用，因此在此方法中**同步调用 setState() 不会触发额外渲染**。通常，我们建议使用 constructor() 来初始化 state。

:::note
如果一个组件中同时存在 componentWillMount 和 getDerivedStateFromProps，这时 componentWillMount 将不再执行，且在控制台会报异常提醒你应该删除 componentWillMount。

测试版本: 16.14.0
:::

### static getDerivedStateFromProps

```js
static getDerivedStateFromProps(props, state)
```

会在调用 render 方法之前调用，并且在初始挂载及后续更新时都会被调用。它应返回一个对象来更新 state，如果返回 null 则不更新任何内容。

请注意，不管原因是什么，都会在每次渲染前触发此方法。这与 `componentWillReceiveProps` 形成对比，后者仅在父组件重新渲染时触发，而不是在内部调用 setState 时。

### render

```js
render()
```

render() 方法是 class 组件中唯一必须实现的方法。

render() 函数应该为纯函数，这意味着在不修改组件 state 的情况下，每次调用时都返回相同的结果，并且它不会直接与浏览器交互。

**如果 shouldComponentUpdate() 返回 false，则不会调用 render()**。

### componentDidMount

```js
componentDidMount()
```

componentDidMount() 会在组件挂载后（插入 DOM 树中）立即调用。依赖于 DOM 节点的初始化应该放在这里。如需通过网络请求获取数据，此处是实例化请求的好地方。

你可以在 componentDidMount() 里**直接调用 setState()**。它将触发额外渲染，但此**渲染会发生在浏览器更新屏幕之前**。如此保证了即使在 render() 两次调用的情况下，用户也不会看到中间状态。请谨慎使用该模式，因为它会导致性能问题。通常，你应该在 constructor() 中初始化 state。

如果你的渲染依赖于 DOM 节点的大小或位置，比如实现 modals 和 tooltips 等情况下，你可以使用此方式处理

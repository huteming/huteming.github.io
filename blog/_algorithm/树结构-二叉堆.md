---
title: 树结构-二叉堆
summary: 树结构-二叉堆
date: 2020-05-24
---

---

## 定义

二叉堆本质上是一种完全二叉树，它分为两个类型。

1. 最大堆

2. 最小堆

### 最大堆

最大堆的任何一个父节点的值，都大于或等于它左、右孩子 节点的值。

![最大堆](/algorithm/最大堆.png)

### 最小堆

最小堆的任何一个父节点的值，都小于或等于它左、右孩子节点的值。

![最小堆](/algorithm/最小堆.png)

### 特点

最大堆和最小堆的特点决定了:

- 最大堆的堆顶是整个堆中的最大元素;

- 最小堆的堆顶是整个堆中的最小元素。

## 二叉堆的自我调整

对于二叉堆，有如下几种操作。

1. 插入节点。

2. 删除节点。

3. 构建二叉堆。

这几种操作都基于堆的自我调整。所谓堆的自我调整，就是把一个不符合堆性质的完全二叉树，调整成一个堆。

> 以下以最小堆为例

### 插入节点

当二叉堆插入节点时，插入位置是完全二叉树的最后一个位置。然后通过不断的与父节点 比较 + 上浮，让整个树重新达到最小值在堆顶的结构

### 删除节点

二叉堆删除节点的过程和插入节点的过程正好相反，所删除的是处于堆顶的节点。

这时，为了继续维持完全二叉树的结构，我们把堆的最后一个节点临时补到原本堆顶的位置。

接下来再以堆顶节点为起点，通过不断的与子节点 比较 + 下沉，让整个树重新达到最小值的堆顶的结构

### 构建二叉堆

构建二叉堆，也就是把一个无序的完全二叉树调整为二叉堆，本质就是让所有**非叶子节点**依次下沉。

## 代码实现

::: tip 时间复杂度

- 插入 和 新增：O(logn)

堆的插入操作是单一节点的“上浮”，堆的删除操作是单一节点的“下沉”，这两个操作的平均交换次数都是堆高度的一半。

- 构建堆：O(n)。

这涉及数学推导过程
:::

### 下沉

```js
function upAdjust(arr) {
  const copyArr = arr.concat();
  let childIndex = copyArr.length - 1;
  let parentIndex = Math.floor((childIndex - 1) / 2);
  const temp = copyArr[childIndex];

  while (parentIndex >= 0 && temp < copyArr[parentIndex]) {
    copyArr[childIndex] = copyArr[parentIndex];
    childIndex = parentIndex;
    parentIndex = Math.floor((parentIndex - 1) / 2);
  }
  copyArr[childIndex] = temp;

  return copyArr;
}
```

### 上浮

```js
function downAdjust(arr, parentIndex) {
  const copyArr = arr.concat();
  const length = copyArr.length;
  const temp = copyArr[parentIndex];
  let childIndex = parentIndex * 2 + 1;

  while (childIndex < length) {
    if (
      childIndex + 1 < length &&
      copyArr[childIndex + 1] < copyArr[childIndex]
    ) {
      childIndex++;
    }
    if (temp <= copyArr[childIndex]) {
      break;
    }
    copyArr[parentIndex] = copyArr[childIndex];
    parentIndex = childIndex;
    childIndex = parentIndex * 2 + 1;
  }
  copyArr[parentIndex] = temp;

  return copyArr;
}
```

### 构建堆

```js
function buildHeap() {
  // 从最后一个非叶子节点开始，依次做“下沉”调整
  const last = Math.floor((arr.length - 2) / 2);
  for (let i = last; i >= 0; i--) {
    downAdjust(arr, i);
  }
}
```

<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/en/rss.xml" title="特明的日志 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/atom.xml" title="特明的日志 Blog Atom Feed"><title data-react-helmet="true">script 标签的 async 和 defer 属性 | 特明的日志</title><meta data-react-helmet="true" property="og:title" content="script 标签的 async 和 defer 属性 | 特明的日志"><meta data-react-helmet="true" name="description" content="我们都知道，浏览器解析 HTML 是一行一行按照顺序向后读取的，在传统的写法中，当浏览器读到 ` 时，便会暂停解析 DOM，同时立即开始下载  中定义的资源，并在下载完成后立刻执行。由于这样的特性，可能会造成 DOM 树在还没有完全解析时就开始执行 JavaScript，需要操作 DOM 的程序可能因此无法正确执行，从而造成许多问题；或是由于 ` 中的资源下载、执行时间过程，用户会卡在白画面，并会产生觉得网站太慢不好用之类的体验。"><meta data-react-helmet="true" property="og:description" content="我们都知道，浏览器解析 HTML 是一行一行按照顺序向后读取的，在传统的写法中，当浏览器读到 ` 时，便会暂停解析 DOM，同时立即开始下载  中定义的资源，并在下载完成后立刻执行。由于这样的特性，可能会造成 DOM 树在还没有完全解析时就开始执行 JavaScript，需要操作 DOM 的程序可能因此无法正确执行，从而造成许多问题；或是由于 ` 中的资源下载、执行时间过程，用户会卡在白画面，并会产生觉得网站太慢不好用之类的体验。"><meta data-react-helmet="true" property="og:url" content="https://huteming.github.io/en/2021/07/09/script 中的 async 和 defer 属性"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/en/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://huteming.github.io/en/2021/07/09/script 中的 async 和 defer 属性"><link data-react-helmet="true" rel="alternate" href="https://huteming.github.io/en/2021/07/09/script 中的 async 和 defer 属性" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://huteming.github.io/2021/07/09/script 中的 async 和 defer 属性" hreflang="zh-Hans"><link data-react-helmet="true" rel="alternate" href="https://huteming.github.io/2021/07/09/script 中的 async 和 defer 属性" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.097ed6fd.css">
<link rel="preload" href="/en/assets/js/runtime~main.4f5e3969.js" as="script">
<link rel="preload" href="/en/assets/js/main.5fca54be.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/en/"><b class="navbar__title">特明的日志</b></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><div class="sidebar_3-2F"><h3 class="sidebarItemTitle_10M-">All Blog Posts</h3><ul class="sidebarItemList_3L1d"><h4 class="sidebarItemTitle_10M-">en</h4><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/08/23/axios源码解析">axios 源码解析</a></li><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/08/20/文本换行">文本换行</a></li><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/08/09/正则表达式">正则表达式</a></li><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/07/16/React 生命周期">React 生命周期</a></li><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/07/15/typeof、instanceof、toString区别">typeof、instanceof、toString区别</a></li><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/07/14/css设置垂直居中">css设置垂直居中</a></li><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/07/13/css加载会造成阻塞吗">css加载会造成阻塞吗</a></li><li class="sidebarItem_3stU"><a class="sidebarItemLink_3hZO" href="/en/2021/07/12/prettier 与 eslint 的集成">prettier 和 eslint 的集成</a></li><li class="sidebarItem_3stU"><a aria-current="page" class="sidebarItemLink_3hZO sidebarItemLinkActive_1XEC" href="/en/2021/07/09/script 中的 async 和 defer 属性">script 标签的 async 和 defer 属性</a></li></ul></div></aside><main class="col col--7"><article><header><h1 class="blogPostTitle_GeHD">script 标签的 async 和 defer 属性</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-07-09T00:00:00.000Z">July 9, 2021</time> · One min read</div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><div class="markdown"><p>我们都知道，浏览器解析 HTML 是一行一行按照顺序向后读取的，在传统的写法中，当浏览器读到 <code>&lt;script&gt;</code> 时，便会<strong>暂停解析</strong> DOM，同时立即开始下载 <code>&lt;script&gt;</code> 中定义的资源，并在下载完成后立刻执行。由于这样的特性，可能会造成 DOM 树在还没有完全解析时就开始执行 JavaScript，需要操作 DOM 的程序可能因此无法正确执行，从而造成许多问题；或是由于 <code>&lt;script&gt;</code> 中的资源下载、执行时间过程，用户会卡在白画面，并会产生觉得网站太慢不好用之类的体验。</p><p>而解决方法也很简单，</p><p>我们需要把 <code>&lt;script&gt;</code> 标签的位置都放到 <code>&lt;body&gt;</code> 的最后一行来避免 DOM 树解析不完全的问题，但是在复杂的网站中， HTML、JavaScript 的个头都很大，需要等到整个 DOM 树都载入完成才开始下载 <code>&lt;script&gt;</code> 内的资源，从网站读取完成到可操作，会产生明显的延迟感。</p><p>那这种问题该怎么解决呢？</p><p>从 HTML4 开始，<code>&lt;script&gt;</code> 多了 defer 属性，而 HTML5 则多了 async，两者都是用来帮助开发者控制 <code>&lt;script&gt;</code> 内资源的载入及执行顺序，以及避免 DOM 的解析被资源下载卡住的。</p><p><img alt="async vs defer" src="/en/assets/images/async-vs-defer-4ade5ab6b6fc46f50f291115bc30c242.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defer"></a>defer<a class="hash-link" href="#defer" title="Direct link to heading">#</a></h2><p><code>defer</code> 的意思是延迟（Deferred），在 HTML4.01 规范 中规定：</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>设置后，这个布尔属性会向用户代理提示该脚本将不会生成任何网页内容（例如，JavaScript 中不会生成 “document.write”），因此，用户代理可以继续解析和渲染。</p></div></div><p>也就是说，在加上 <code>defer</code> 属性后，浏览器会继续解析、渲染画面，而不会因为需要载入 <code>&lt;script&gt;</code> 内的资源而卡住；实际执行时，会在 <code>DOMContentLoaded</code> 执行之前，由上到下的依照摆放顺序触发。</p><p>听起来很方便对吧？但要提醒各位，虽然 W3C 规范上说 <code>defer</code> 属性会是一个布尔值，但 IE9 以前的版本是自定义的，即使写成 <code>&lt;script defer=&quot;false&quot;&gt;</code> 仍然会有 <code>defer</code> 的效果，使用时要特别注意。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="async"></a>async<a class="hash-link" href="#async" title="Direct link to heading">#</a></h2><p><code>async</code> 的意思是异步（Asynchronous），在 HTML5 规范 中规定：</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>…如果存在 async 属性，则脚本将会在可用时立即异步执行 …</p></div></div><p>在 <code>&lt;script&gt;</code> 标签中加上 <code>async</code> 属性后，与 <code>defer</code> 的相同点是也会在后台执行下载，但不同的是当下载完成会马上暂停 DOM 解析（如果还没有解析完成的话），并开始执行 JavaScript。因为下载完成后会立即执行，加上 <code>async</code> 属性后，就无法保证执行顺序了。</p><p>这个属性在标准中，同时也支持通过 JavaScript 动态插入 <code>&lt;script&gt;</code> 的情况。例如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> script </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;script&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">script</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/something/awesome.js&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">script</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>动态创建的 <code>&lt;script&gt;</code>，默认就是异步载入；但可以通过设定属性将它关闭：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">script</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">async</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="typemodule"></a>type=&quot;module&quot;<a class="hash-link" href="#typemodule" title="Direct link to heading">#</a></h2><p>在主流的现代浏览器中，<code>&lt;script&gt;</code> 的属性可以加上 <code>type=&quot;module&quot;</code>。这时浏览器会认为这个文件是一个 JavaScript 模块，其中的解析规则、执行环境会略有不同；这时 <code>&lt;script&gt;</code> 的默认行为会像是 <code>defer</code> 一样，在后台下载，并且等待 DOM 解析、渲染完成之后才会执行，所以 <code>defer</code> 属性无法在 <code>type=&quot;module&quot;</code> 的情况下发生作用。但同样可以通过 <code>async</code> 属性使它在下载完成后即刻执行。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="用法"></a>用法<a class="hash-link" href="#用法" title="Direct link to heading">#</a></h2><p>现在你应该明白这两个属性的特点了，那么该怎样正确地使用呢？</p><p>defer 由于后台载入、不打断渲染及确保执行顺序的特点，基本上在没特殊需求的情况下，在 <code>&lt;script&gt;</code> 中设置一下就行了；当然 <code>&lt;script&gt;</code> 本身的摆放顺序还是要稍微留心一下。</p><p><code>async</code> 比较特别，因为在下载后会立刻执行，且不保证执行顺序，一般常见的应用是设定在完全独立的小小模块中，例如背景 Logo、页面广告等，在避免造成使用者体验变差的同时，尽量早的产生效果。</p><p>现在前端开发大都通过 Webpack 等打包工具来辅助处理，很少有自己设定这些属性的机会；开发者可以通过 <a href="https://github.com/numical/script-ext-html-webpack-plugin" target="_blank" rel="noopener noreferrer">script-ext-html-webpack-plugin</a> 等插件的帮助，将切分好的 Chunk 设定个别需要的 <code>&lt;script&gt;</code> 属性。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="总结"></a>总结<a class="hash-link" href="#总结" title="Direct link to heading">#</a></h2><p><code>async</code> 及 <code>defer</code> 是 <code>&lt;script&gt;</code> 专属的属性，对于网页中的其他资源，可以通过 <code>&lt;link&gt;</code> 的 preload、prefetch 属性，来帮我们<strong>延迟加载</strong> 未来才需要用到的资源。</p><p>虽然 <code>&lt;script&gt;</code> 的<code>async</code>、<code>defer</code> 这些属性的设置大都已经包含在现代框架的打包流程中了，但只有扎实的认识这些网页最基础的规范，才能明白自己写出来的代码最后会产生什么效果。</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/en/tags/浏览器">浏览器</a><a class="margin-horiz--sm" href="/en/tags/性能优化">性能优化</a></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2021-07-09-script 中的 async 和 defer 属性.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/en/2021/07/12/prettier 与 eslint 的集成"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« prettier 和 eslint 的集成</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#defer" class="table-of-contents__link">defer</a></li><li><a href="#async" class="table-of-contents__link">async</a></li><li><a href="#typemodule" class="table-of-contents__link">type=&quot;module&quot;</a></li><li><a href="#用法" class="table-of-contents__link">用法</a></li><li><a href="#总结" class="table-of-contents__link">总结</a></li></ul></div></div></div></div></div></div>
<script src="/en/assets/js/runtime~main.4f5e3969.js"></script>
<script src="/en/assets/js/main.5fca54be.js"></script>
</body>
</html>